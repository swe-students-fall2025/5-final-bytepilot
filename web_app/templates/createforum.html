{% extends "base.html" %}

{% block title %}Create Forum - Forum{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{{ url_for('index') }}">Home</a> &gt;
    <a href="{{ url_for('forum') }}">Forum</a> &gt;
    <span>Create Forum</span>
</div>
{% endblock %}

{% block content %}
<div class="auth-page-container wide luxe-bg">
    <div class="auth-box-forum glassy">
        <div class="auth-box-header">
            <h2>Create New Forum</h2>
            <p>Generate fan fiction dialogues with forum styling</p>
        </div>

        <form class="auth-form-forum" id="create-forum-form">
            <div class="form-group">
                <label for="forum-title">Forum Title:</label>
                <input type="text" id="forum-title" name="forum-title" required autofocus placeholder="Enter forum title">
            </div>

            <div class="form-group">
                <div class="character-select-header">
                    <label>Select Characters:</label>
                    <a href="{{ url_for('addcharacter') }}" class="btn btn-secondary">Add Character</a>
                </div>
                <div id="selected-characters-tags" class="selected-characters-tags">
                    <p class="empty-message">No characters selected. Search and click on characters below to add them.</p>
                </div>
                <div class="character-search-container">
                    <input type="text" id="character-search-input" class="character-search-input" placeholder="Search characters by name, nickname, or fandom...">
                    <div id="character-search-results" class="character-search-results hidden"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Dialogue Posts:</label>
                <div id="posts-container"></div>
                <div class="add-post-container">
                    <button type="button" class="btn btn-secondary" id="add-post-btn">Add Post</button>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="save-draft-btn">Save as Draft</button>
                <button type="button" class="btn btn-primary" id="publish-btn">Publish</button>
                <a href="{{ url_for('forum') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>

    <div id="preview-modal" class="preview-modal hidden">
        <div class="preview-modal-content glassy">
            <div class="preview-modal-header">
                <h3>Forum Preview</h3>
                <button type="button" class="close-preview" id="close-preview-btn">&times;</button>
            </div>
            <div class="preview-modal-body" id="preview-content"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="application/json" id="characters-data">
{{ characters | tojson | safe }}
</script>
<script>
    (() => {
        const el = document.getElementById('characters-data');
        let parsed = [];
        if (el) {
            try { parsed = JSON.parse(el.textContent || '[]'); }
            catch (e) { console.error('Failed to parse characters data in template:', e); }
        }
        window.WINDOW_CHARACTERS_DATA = parsed;
        window.INIT_CHARACTERS = parsed;
    })();
</script>
{% endblock %}
